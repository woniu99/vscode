# chapter 5 与HTTP协作的web服务器
## 1. 用单台虚拟主机实现多个域名
- 在相同的IP地址下，由于虚拟主机可以寄存多个不同主机名和域名的web网站，因此在发送HTTP请求时，必须在Host首部内完整指定主机名或域名的URI。
## 2. 通信数据转发程序：代理、网关、隧道
- HTTP通信时，除客户端和服务器以外，还有一些用于通信数据转发的应用程序，它们配合服务器工作。这些应用程序和服务器可以将请求转发给通信线路上的下一站服务器，并且能接收从那台服务器发送的响应再转发给客户端。
### 1. **代理**
- 代理时一种有转发功能的应用程序，它扮演了位于服务器和客户端“中间人”的角色，接收由客户端发送的请求并转发给服务器，同时也接收服务器返回的响应并转发给客户端。
- 代理不改变请求的URI，会直接发送给前方持有资源的目标服务器。
- 每次经过代理服务器转发请求或响应时，会追加Via首部信息，例如：`Via:proxy2,proxy2...`,以标记出经过的主机信息。
- 使用代理服务器的理由：利用缓存技术减少网络带宽的流量，组织内部针对特定网站的访问控制，以获取访问访问日志为主要目的，等等。
- 代理划分： 1. 是否使用缓存，2.是否会修改报文
- **缓存代理**
- 代理转发响应时，缓存代理（Caching Proxy）会预先将资源的副本（缓存）保存在代理服务器上。
- 当代理再次接受到对相同资源的请求时，就可以不从源服务器哪里获取资源，而是将之前缓存的资源作为响应返回。
- **透明代理**
- 转发请求或响应时，不对报文做任何加工的代理类型被称为*透明代理*，反之，对报文内容进行加工的代理成为非透明代理。
### 2. **网关**
- 网关是转发其他服务器通信数据的服务器，接收从客户端发送来的请求时，它就像自己拥有资源的源服务器一样对请求进行处理。有时客户端可能都不会察觉，自己的通信目标是一个网关。
- 利用网关能提高通信的安全性，因为可以在客户端与网关之间的通信线路上加密以确保连接的安全。比如，网关可以连接数据库，使用SQL语句查询数据。另外，在Web购物网站上进行信用卡结算时，网关可以和信用卡结算系统联动。
### 3. **隧道**
- 隧道是在相隔甚远的客户端和服务器两者之间进行中转，并保持双方通信连接的应用程序。
- 隧道可按要求建立一条与其他服务器的通信线路，届时使用SSL等加密手段进行通信。隧道的目的时确保客户端能与服务器进行安全的通信。
## 3. 保存资源的缓存
 - 1. 缓存的有效期限
 - 缓存服务器的缓存也存在一个有效期限。当遇上服务器上的资源更新时，如果还是使用不同的缓存，那就会演变成返回更新前的“旧”资源了。
 - 2. 客户端的缓存
 - 浏览器的缓存如果有效，就不必再向服务器请求相同的资源了，可以直接从本地磁盘内读取。
 - 当判定缓存过期后，会向源服务器确认资源的有效性。若判断浏览器缓存失效，浏览器会再次请求新资源。